{% extends 'store/base.html' %}
{% load static %}


{% block title %} {{app.Name}} {% endblock %} 
{% block styles %} 
    <link rel="stylesheet" href="{% static 'store/new_item_style.css' %}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
{% endblock %}

{% block content %}
    <div id="contain">
        <div id="body">
            <div class="item">
                <div id="images">
                    <img src="{{app.Image.url}}" width="200px" height="350px" alt="Book Cover">
                    <div class="mini-images">
                        <a href=""><img src="{{app.Image1.url}}" width="50px" height="70px" alt="Book Cover"></a>
                        <a href=""><img src="{{app.Image2.url}}" width="50px" height="70px" alt="Book Cover"></a>
                        <a href=""><img src="{{app.Image3.url}}" width="50px" height="70px" alt="Book Cover"></a>
                    </div>
    
                </div>
                
                <div class="description">
                    <h2 style="color: #27995e;">{{app.Name}}</h2>
                    <div style="color: #27995e;" id="special">
                        <h3>
                            {% ifequal currency "LBP" %}
                            LBP {{app.PriceLBP}}
                            {% endifequal %}

                            {% ifequal currency "USD" %}
                            $ {{app.PriceUSD}}
                            {% endifequal %}
                        </h3>
                        <h4><a href="" style="color: #27995e;">-> add to WishList</a></h4>
                    </div>
                    <table>
                        <tr>
                            <td class="title">Rating: </td>
                            <td>
                                {% for i in '12345' %}
                                    {% if i|add:0 <= books.Rating %}
                                        <span class="fa fa-star checked"></span>
                                    {% else %}
                                        <span class="fa fa-star"></span>
                                    {% endif %}
                                {% endfor %}
                            </td>
                        </tr>
                        <tr>
                            <td class="title">Average Reviews: </td>
                            <td>
                                {% for i in '12345' %}
                                    {% if i|add:0 <= average %}
                                        <span class="fa fa-star checked"></span>
                                    {% else %}
                                        <span class="fa fa-star"></span>
                                    {% endif %}
                                {% endfor %}
                            </td>
                        </tr>
                        <tr>
                            <td class="title">Reviewers #:</td>
                            <td>{{ reviews|length }}</td>
                        </tr>
                        <tr>
                            <td class="title">Genre: </td>
                            <td>{{app.Genre}}</td>
                        </tr>
                        <tr>
                            <td class="title">Release Date: </td>
                            <td>{{ app.Date }}</td>
                        </tr>
                        <tr>
                            <td class="title">Sales (copies): </td>
                            <td>{{ app.CopiesSold }}</td>
                        </tr>
                        <tr>
                            <td class="title">Description: </td>
                            <td>{{app.Description}}</td>
                        </tr>
                    </table>
                </div>
            </div>
            <br>
            
            <div id="Reviews">
                <table>
                    <thead>
                        <th colspan="2"><h3 id="rev">Reviews: </h3></th>
                    </thead>
                    <tbody>
                        {% for review in reviews|slice:':5' %}
                            <tr>
                                <td>
                                    <img src="{{ review.user.profile.Image.url }}">
                                </td>
                                <td>
                                    <div class="review">
                                        <div class="author">
                                            <h5>{{ review.user.username }}</h5>
                                            {% for i in '12345' %}
                                                {% if i|add:0 <= review.Rating %}
                                                    <span class="fa fa-star checked"></span>
                                                {% else %}
                                                    <span class="fa fa-star"></span>
                                                {% endif %}
                                            {% endfor %}
                                        </div>
                                        <div id="span">
                                            <form method="POST">
                                                {% csrf_token %}
                                                <button name="like" value="{{review.id}}"><span class="fa fa-thumbs-up">{{review.likes}}  |</span></button>
                                            </form>
                                            <form method="POST">
                                                {% csrf_token %}
                                                <button name="dislike" value="{{review.id}}"><span class="fa fa-thumbs-down">{{review.dislikes}}  |</span></button>
                                            </form>
                                            <form method="POST">
                                                {% csrf_token %}
                                                <button name="report" value="{{review.id}}"><span class="fa fa-flag"></span></button>
                                            </form>
                                        </div>
                                    </div>
                                    <p>{{review.content}}</p>
                                </td>
                            </tr>
                        {% endfor %}
                        {% for review in reviews|slice:'5:' %}
                            <tr style="display:none;">
                                <td>
                                    <img src="{{ review.user.profile.Image.url }}">
                                </td>
                                <td>
                                    <div class="review">
                                        <div class="author">
                                            <h5>{{ review.user.username }}</h5>
                                            {% for i in '12345' %}
                                                {% if i|add:0 <= review.Rating %}
                                                    <span class="fa fa-star checked"></span>
                                                {% else %}
                                                    <span class="fa fa-star"></span>
                                                {% endif %}
                                            {% endfor %}
                                        </div>
                                        <div id="span">
                                            <form method="POST">
                                                {% csrf_token %}
                                                <button name="like" value="{{review.id}}"><span class="fa fa-thumbs-up">{{review.likes}}  |</span></button>
                                            </form>
                                            <form method="POST">
                                                {% csrf_token %}
                                                <button name="dislike" value="{{review.id}}"><span class="fa fa-thumbs-down">{{review.dislikes}}  |</span></button>
                                            </form>
                                            <form method="POST">
                                                {% csrf_token %}
                                                <button name="report" value="{{review.id}}"><span class="fa fa-flag"></span></button>
                                            </form>
                                        </div>
                                    </div>
                                    <p>{{review.content}}</p>
                                </td>
                            </tr>
                        {% endfor %}
                    </tbody>
                    <th colspan="2" id="seeAll"><button id="button">See all Reviews...</button></th>
                </table>
            </div>
            
            <h3 id="sim">Similar Products: </h3>
            <div class="test1-list">
                {% for apps in similarApps %}
                    {% if apps.Name != app.Name %}
                        <div class="test1">
                            <div class="inner-test1">
                                <div class="figure-image">
                                    <a href="single.html"><img src="{{ apps.Image.url }}" alt="cover1"></a>
                                </div>
                                <h3 class="test1-title"><a href="#">{{ apps.Name }}</a></h3>
                                <h3 class="test1-category"><a href="#">{{ apps.Genre }}</a></h3>
                                <small class="price">$ {{ apps.PriceUSD }}</small>
                            </div>
                        </div>
                    {% endif %}
                {% endfor %}
            </div>
        </div>
    </div>

    <script>
        window.onload = function() {
            document.getElementById("button").onclick = displayReviews ;
        }

        function $(id) {return document.getElementById(id) ;} 

        function displayReviews(){
            let table = document.getElementById("Reviews") ;
            let review_rows = table.getElementsByTagName("tr") ;
            for(let i = 0 ; i < review_rows.length ; i++) {
                review_rows[i].style.display = "table-row" ;
            }
            document.getElementById("seeAll").style.display = "none";
        }
    </script>
{% endblock %}